---
import Layout from "../../layouts/Layout.astro";
import { wpQuery } from "../../lib/wp";
import { rewriteWpUrl } from "../../lib/wpUrl";
import HOME_QUERY from "../../queries/home";
import HeroCategoryImages from "../../components/HeroCategoryImages.astro";

export async function getStaticPaths() {
  return [{ params: { lang: "th" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params as { lang: "th" | "en" };

// hreflang alternates
const alternates = [
  { lang: "th", url: "/th" },
  { lang: "en", url: "/en" },
];

// ========= ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏à‡∏≤‡∏Å WordPress =========
let heroTitle = "";
let heroSubtitle = "";
let heroImageUrl = "";
let wpDataFound = false;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
function pickImageUrl(imageNode?: any): string | undefined {
  if (!imageNode) return undefined;
  const sizes: Array<any> = imageNode?.mediaDetails?.sizes ?? [];
  const prefer = ["large", "medium_large", "2048x2048", "1536x1536", "medium"];
  for (const name of prefer) {
    const size = sizes.find((x: any) => x?.name === name);
    if (size?.sourceUrl) return rewriteWpUrl(size.sourceUrl);
  }
  return rewriteWpUrl(imageNode?.sourceUrl);
}

// ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤ (‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á WP)
heroTitle = lang === "en" ? "Smart Bed" : "‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞";
heroSubtitle =
  lang === "en"
    ? "Innovative Care for the Ones You loved ones"
    : "‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å";

// ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å WP (‡∏´‡∏ô‡πâ‡∏≤ Home ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏≤)
wpDataFound = true;
const uriCandidates =
  lang === "en"
    ? ["/home", "/home/", "/", "/en", "/en/", "/home-en"]
    : ["/‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å", "/‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å/", "/", "/th", "/th/", "/home-th"];

for (const uri of uriCandidates) {
  try {
    const wpData = await wpQuery<{ nodeByUri: any }>(HOME_QUERY, { uri });
    const pageData = wpData?.nodeByUri;
    if (pageData?.hero?.heroImage?.node) {
      heroImageUrl = pickImageUrl(pageData.hero.heroImage.node) || "";
      break;
    }
  } catch (error: any) {
    continue;
  }
}

// CTA Button text
const ctaText = lang === "en" ? "Contact Us" : "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤";
---

<Layout lang={lang} showNavLinks={true} alternates={alternates}>
  <!-- ============== Hero Section ============== -->
  <section class="relative overflow-hidden min-h-screen">
    <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á -->
    {heroImageUrl ? (
      <div class="absolute inset-0 z-0">
        <img
          src={heroImageUrl}
          alt="Hero Background"
          class="w-full h-full object-cover"
          style="object-position:center; image-rendering: crisp-edges;"
          loading="eager"
        />
      </div>
    ) : (
      <div class="absolute inset-0 z-0">
        <!-- Gradient background with pattern -->
        <div class="absolute inset-0 bg-gradient-to-br from-blue-600 via-cyan-500 to-blue-700"></div>
        <div class="absolute inset-0 opacity-10" 
             style="background-image: url('data:image/svg+xml,%3Csvg width=60 height=60 viewBox=0 0 60 60 xmlns=http://www.w3.org/2000/svg%3E%3Cg fill=none fill-rule=evenodd%3E%3Cg fill=%23ffffff fill-opacity=0.1%3E%3Ccircle cx=7 cy=7 r=5/%3E%3Ccircle cx=53 cy=7 r=5/%3E%3Ccircle cx=30 cy=30 r=5/%3E%3Ccircle cx=53 cy=53 r=5/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
      </div>
    )}

    <div class="relative z-10 mx-auto max-w-[1440px] px-6 pt-16 pb-20">
      <div class="grid lg:grid-cols-2 gap-12 items-center min-h-[600px] mb-16">
        <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
        <div class="text-white lg:pr-8">
          <h1 class="font-extrabold leading-[1.05] mb-6 text-[clamp(40px,6.2vw,84px)]"
              style="text-shadow: 2px 2px 12px rgba(0,0,0,.8);">
            {heroTitle}
          </h1>
          <p class="font-light opacity-95 whitespace-pre-line mb-10 text-[clamp(18px,2vw,28px)] leading-relaxed"
             style="text-shadow: 1px 1px 8px rgba(0,0,0,.7);">
            {heroSubtitle}
          </p>

          <a href={lang === "en" ? "/en/contact" : "/th/contact"}
             class="inline-flex items-center gap-3 rounded-full bg-white text-cyan-600 font-semibold shadow-xl hover:shadow-2xl h-[60px] px-8 text-[18px] hover:bg-gray-50 transition-all duration-300 hover:scale-105 hover:-translate-y-1">
            {ctaText}
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M5 12H19M19 12L12 5M19 12L12 19"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>

        <!-- ‡∏Ç‡∏ß‡∏≤: ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏û‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏ü (‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ó‡∏ô) -->
        <div class="hidden lg:block"></div>
      </div>

      <!-- ============== Hero Gallery Slider ============== -->
      <HeroCategoryImages
        lang={lang}
        categorySlug="hero"
        limit={8}
        class="mx-auto max-w-none"
      />
    </div>
  </section>

  <!-- ============== Smart Bed Features Section ============== -->
  <section class="py-20 lg:py-32 bg-gradient-to-b from-white to-gray-50">
    <div class="mx-auto max-w-[1440px] px-6">
      <div class="text-center mb-16">
        <h2 class="text-4xl lg:text-5xl font-bold text-gray-800 mb-6">
          {lang === "en" ? "Smart Bed Features" : "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞"}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {lang === "en" 
            ? "Advanced technology meets exceptional patient care with our innovative hospital bed solutions."
            : "‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ú‡∏™‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ã‡∏•‡∏π‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏±‡∏ô‡∏•‡πâ‡∏≥‡∏™‡∏°‡∏±‡∏¢"
          }
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
        {[
          {
            icon: "üîÑ",
            title: lang === "en" ? "Left-right side tilt adjustment" : "‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤",
            desc:
              lang === "en"
                ? "Advanced lateral positioning system for optimal patient comfort and medical procedures."
                : "‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°",
            color: "from-blue-500 to-cyan-500"
          },
          {
            icon: "üìê",
            title: lang === "en" ? "Height adjustment" : "‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á", 
            desc:
              lang === "en"
                ? "Smooth height adjustment mechanism for easy patient transfer and caregiver access."
                : "‡∏Å‡∏•‡πÑ‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•",
            color: "from-green-500 to-teal-500"
          },
          {
            icon: "ü¶µ",
            title: lang === "en" ? "Leg section up-down adjustment" : "‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≤ ‡∏Ç‡∏∂‡πâ‡∏ô-‡∏•‡∏á",
            desc:
              lang === "en"
                ? "Ergonomic leg positioning for improved circulation and patient comfort."
                : "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≤‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏£‡∏µ‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô",
            color: "from-purple-500 to-pink-500"
          },
        ].map((feature, index) => (
          <div class={`bg-gradient-to-br ${feature.color} p-1 rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 hover:scale-105 group`}>
            <div class="bg-white rounded-3xl p-8 h-full">
              <div class="text-5xl mb-6 text-center transform group-hover:scale-110 transition-transform duration-300">
                {feature.icon}
              </div>
              <h3 class="text-xl font-bold text-gray-800 text-center mb-4 leading-tight">
                {feature.title}
              </h3>
              <p class="text-gray-600 text-center leading-relaxed">
                {feature.desc}
              </p>
            </div>
          </div>
        ))}
      </div>

      <!-- Call-to-Action -->
      <div class="text-center mt-16">
        <a href={`/${lang}/contact`} 
           class="inline-flex items-center gap-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-semibold px-8 py-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:-translate-y-1 text-lg">
          {lang === "en" ? "Learn More About Our Solutions" : "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏ã‡∏•‡∏π‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤"}
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M5 12H19M19 12L12 5M19 12L12 19"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Smooth animations */
  * {
    transition-property: transform, box-shadow, background-color;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Glass effect for buttons */
  .glass-effect {
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
</style>